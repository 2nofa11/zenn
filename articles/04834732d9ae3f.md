---
title: "eslint-plugin-vueからVueを学ぶ"
emoji: "🐡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Vue","フロントエンド"]
published: false
---
## はじめに

`eslint-plugin-vue`には、Vueのコーディング作法の情報が詰まっています。
本記事では、一部のルールを取り上げ、その背後にある「なぜ」を紐解きます。
前提知識としては、Vue3の基本的な構文やComposition APIを理解していることとして以降は記述します。

## 取り上げるルール

`eslint-plugin-vue` には多くのルールがあります(2024/11/23時点で137個)。本記事では以下3つをピックアップし、それぞれの意図や対処法を考えます。

1. **vue/no-v-html**
2. **vue/no-async-in-computed-properties**
3. **vue/no-lifecycle-after-await**

### 1. [vue/no-v-html](vue/no-v-html)：`v-html`の使用禁止（または制限）

![eslint-plugin-vue](/images/04834732d9ae3f-1.png)

**理由**：
 `v-html`は任意のHTMLを挿入可能であり、XSS攻撃の温床になり得ます。（公式より）

> セキュリティーに関する注意
>
> ウェブサイト上で任意の HTML を動的にレンダリングすることは、[XSS 攻撃](https://ja.wikipedia.org/wiki/クロスサイトスクリプティング)につながりやすいため、非常に危険です。信頼できるコンテンツにのみ `v-html` を使用し、ユーザーが提供するコンテンツには**絶対に**使用しないでください。


Vueはデフォルトで`{{ }}`内のデータをエスケープするため、XSS回避が容易ですが、`v-html`を使うとこれをスキップしてしまいます。

**学び**：

- セキュアなコーディングが重要。外部データは常にサニタイズする。
- どうしても生HTMLが必要なら`DOMPurify`などでサニタイズしてからレンダリング。

**改善例**：

```vue
<template>
  <div>{{ sanitizedContent }}</div>
</template>

<script setup>
import { computed } from 'vue';
import DOMPurify from 'dompurify';

const props = defineProps({ rawHtmlContent: String });
const sanitizedContent = computed(() => DOMPurify.sanitize(props.rawHtmlContent));
</script>
```

### 2. [vue/no-async-in-computed-properties](vue/no-async-in-computed-properties)：計算プロパティ内での非同期処理禁止

![vue/no-async-in-computed-properties](/images/04834732d9ae3f-2.png)

**理由**：
 `computed`プロパティは同期的な評価が前提です。非同期処理を入れると、予測不可能な更新タイミングや依存関係追跡の難化を引き起こします。

**学び**：

- 非同期処理は`onMounted`や`watch`、`methods`で行い、その結果を`ref`に格納する。
- 計算プロパティは純粋関数であり、副作用・非同期は避ける。

**改善例**：

```vue
<template>
  <div>{{ data }}</div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const data = ref(null);
onMounted(async () => {
  const response = await fetch('https://api.example.com/data');
  data.value = await response.json();
});
</script>
```

### 3. [vue/no-lifecycle-after-await](vue/no-lifecycle-after-await)：`await`後のライフサイクルフック登録禁止

![vue/no-lifecycle-after-await](/images/04834732d9ae3f-3.png)

**理由**：
 ライフサイクルフック(`onMounted`等)は`setup`内で同期的に登録する必要があります。`await`を挟むことでフック登録が遅れ、ライフサイクルの順序が崩れる可能性があります。

| BADな例                                  | GOODな例                                   |
| ---------------------------------------- | ------------------------------------------ |
| ![Bad](/images/04834732d9ae3f-Bad.png) | ![Good](/images/04834732d9ae3f-Good.png) |

**学び**：

- フックは`setup`内で同期的に宣言する。
- 非同期初期化はフック内で`await`する形で行う。

**改善例**：

```vue
<script setup>
import { onMounted } from 'vue';

async function initializeApp() {
  // 非同期処理
}

onMounted(async () => {
  await initializeApp();
  // 続きの初期化
});
</script>
```

------

## まとめ

`eslint-plugin-vue`のルールは、Vue.jsコードの品質を高める具体的なガイドラインです。

- `no-v-html`：XSS対策を意識する。
- `no-async-in-computed-properties`：計算プロパティは同期＆純粋関数で。
- `no-lifecycle-after-await`：ライフサイクルフックは同期的に登録する。

これらを理解すると、Vue.jsのコードがよりセキュア、予測可能、可読性・保守性の高いものになっていきます。